# basic variables
PREFIX = @prefix@
CC = @CC@
INSTALL = @INSTALL@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@

# mysql
MYSQL_CFLAGS = @MYSQL_CFLAGS@
MYSQL_LDFLAGS = @MYSQL_LDFLAGS@ @MYSQL_RPATH@ @MYSQL_LIBS@

# gearman
GEARMAN_CFLAGS = @GEARMAN_CFLAGS@
GEARMAN_LDFLAGS = @GEARMAN_LDFLAGS@ @GEARMAN_RPATH@ @GEARMAN_LIBS@

SOURCE = dispatcher.c
HEADER = dispatcher.h
OBJECT = dispatcher.o

# setup final compiler flags
CFLAGS_REAL = $(CFLAGS) $(MYSQL_CFLAGS) $(GEARMAN_CFLAGS)
LDFLAGS_REAL = $(LDFLAGS) $(MYSQL_LDFLAGS) $(GEARMAN_LDFLAGS)

all: dispatcher

$(OBJECT): $(SOURCE) $(HEADER)
	$(CC) $(CFLAGS_REAL) -c $*.c -o $*.o

dispatcher: $(OBJECT)
	$(CC) $(OBJECT) $(LDFLAGS_REAL) -o dispatcher

clean:
	rm -f $(OBJECT) dispatcher
	
distclean: clean
	rm -f config.log config.status config.h configure Makefile
	rm -rf autom4te.cache .deps

install:
	$(INSTALL) -m 755 dispatcher $(PREFIX)/bin

.PHONY: all clean distclean install
